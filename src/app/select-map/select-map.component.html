<div class="select-map-overlay" [class.visible]="isOpen" (click)="close()">
  <div class="select-map-dialog" (click)="$event.stopPropagation()">
    
    <app-header parentType="game-map"></app-header>
    
    <div class="select-map-header">
      <div class="title">
        <lucide-icon name="map" class="lucide-icon" [size]="32" color="#FFFFFF"></lucide-icon>
        <h2>SELECIONAR MAPA</h2>
      </div>
    </div>

    <div *ngIf="loading" class="loading-state">
      <div class="loading-spinner">
        <lucide-icon name="loader-2" class="lucide-icon spinning" [size]="48"></lucide-icon>
      </div>
      <p>Carregando mapas...</p>
    </div>

    <div class="select-map-content" *ngIf="!loading">
      
      <div class="gamemaps-grid" *ngIf="gameMaps.length > 0">
        <div 
          *ngFor="let gameMap of gameMaps; let i = index" 
          class="gamemap-card"
          [class.main-story-card]="gameMap.id === 2"
          (click)="selectMap(gameMap)">
          
          <!-- Card especial para História Principal (ID: 2) -->
          <div class="main-story-preview" *ngIf="gameMap.id === 2">
            <img src="assets/images/faculdade.png" alt="História Principal Preview" class="story-preview-image">
            <div class="main-story-badge">
              <lucide-icon name="star" class="lucide-icon" [size]="16"></lucide-icon>
              <span>HISTÓRIA PRINCIPAL</span>
            </div>
          </div>

          <div class="gamemap-header">
            <div class="gamemap-icon">
              <lucide-icon name="map-pin" class="lucide-icon" [size]="24"></lucide-icon>
            </div>
            <div class="gamemap-title">
              <h3>{{ gameMap.title }}</h3>
              <span class="gamemap-id">ID: {{ gameMap.id }}</span>
            </div>
          </div>

          <div class="gamemap-stats">
            <div class="stat-item phases">
              <lucide-icon name="gamepad-2" class="lucide-icon" [size]="16"></lucide-icon>
              <span class="stat-value">{{ getMapStats(gameMap).phases }}</span>
              <span class="stat-label">Fases</span>
            </div>
            
            <div class="stat-item users">
              <lucide-icon name="users" class="lucide-icon" [size]="16"></lucide-icon>
              <span class="stat-value">{{ getMapStats(gameMap).users }}</span>
              <span class="stat-label">Usuários</span>
            </div>
          </div>

          <div class="gamemap-details">
            <!-- Não exibir data para História Principal (ID: 2) -->
            <div class="detail-item" *ngIf="gameMap.createdAt && gameMap.id !== 2">
              <lucide-icon name="calendar" class="lucide-icon" [size]="14"></lucide-icon>
              <span class="detail-text">{{ formatDate(gameMap.createdAt) }}</span>
            </div>
            
            <div class="detail-item" *ngIf="gameMap.createdByUser">
              <lucide-icon name="user" class="lucide-icon" [size]="14"></lucide-icon>
              <!-- Estilo especial para o autor da História Principal -->
              <span class="detail-text" [class.main-story-author]="gameMap.id === 2">{{ gameMap.createdByUser.name }}</span>
            </div>
          </div>

          <div class="selection-indicator">
            <lucide-icon name="mouse-pointer-click" class="lucide-icon" [size]="20"></lucide-icon>
            <span>Clique para selecionar</span>
          </div>
        </div>
      </div>

      <div *ngIf="gameMaps.length === 0" class="empty-state">
        <div class="empty-icon">
          <lucide-icon name="map-pin-off" class="lucide-icon" [size]="64"></lucide-icon>
        </div>
        <h3>Nenhum mapa disponível</h3>
        <p>Não há GameMaps cadastrados no sistema.</p>
        <p>Entre em contato com o administrador para criar novos mapas.</p>
      </div>
    </div>
  </div>
</div>
