<div class="backpack-overlay" [class.visible]="isOpen" (click)="close()">
  <div class="backpack-dialog" (click)="$event.stopPropagation()">
    <div class="backpack-header">
      <div class="header-left">
        <button class="btn-icon close-button" (click)="close()">
          <lucide-icon name="x" class="lucide-icon"></lucide-icon>
        </button>
      </div>
      <div class="title">
        <lucide-icon name="backpack" class="lucide-icon" [size]="32" color="#FFFFFF"></lucide-icon>
        <h2>MOCHILA</h2>
      </div>
    </div>
    <div class="backpack-content">

      <ng-container *ngFor="let item of backpackData?.items; let i = index">
        <div 
          #itemSlot
          class="inventory-slot filled"
          [class.selected]="selectedItem === item"
          (mouseenter)="onItemHover(item, $event)"
          (mouseleave)="onItemLeave()"
          (click)="onItemClick(item)">
          <img [src]="item.imageUrl" [alt]="item.name">
          <span class="quantity-badge" *ngIf="item.quantity > 1">{{ item.quantity }}</span>
        </div>
      </ng-container>

      <div 
        *ngFor="let slot of emptySlots" 
        class="inventory-slot empty">
      </div>
    </div>
    
    <div class="backpack-footer">
      <button 
        class="use-item-button" 
        [disabled]="!canUseItems || !selectedItem"
        (click)="onUseItem()">
        <lucide-icon name="zap" [size]="18"></lucide-icon>
        <span>{{ selectedItem ? 'USAR ' + selectedItem.name.toUpperCase() : 'SELECIONE UM ITEM' }}</span>
      </button>
    </div>
  </div>

  <!-- Tooltip flutuante fora do contexto do modal -->
  <div 
    class="description-slot" 
    [class.expanded]="hoveredItem !== null"
    [style.top.px]="tooltipTop"
    [style.left.px]="tooltipLeft">
    <div class="description-content" *ngIf="hoveredItem">
      <h4>{{ hoveredItem.name }}</h4>
      <p>{{ hoveredItem.description }}</p>
    </div>
  </div>
</div>
