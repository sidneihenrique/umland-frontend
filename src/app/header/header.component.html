<header>
    <div class="left">
        <button class="btn-icon filled" id="exit" *ngIf="parentType === 'game-phase'" (click)="exitGame()">
            <lucide-icon class="lucide-icon" name="X"></lucide-icon>
        </button>
        
        <div class="logout-container" *ngIf="parentType === 'game-map'">
            <button 
                class="btn-icon log-out accordion-button" 
                [class.active]="isAccordionOpen"
                (click)="isInMapRoute ? toggleAccordion() : logout()">
                <lucide-icon class="lucide-icon" name="log-out"></lucide-icon>
            </button>
            
            <div class="accordion-menu" *ngIf="isInMapRoute && isAccordionOpen">
                <button class="accordion-option" (click)="returnToMapSelection()">
                    <lucide-icon class="lucide-icon" name="map" [size]="20"></lucide-icon>
                    <span>Seleção de Mapas</span>
                </button>
                <button class="accordion-option logout-option" (click)="logout()">
                    <lucide-icon class="lucide-icon" name="log-out" [size]="20"></lucide-icon>
                    <span>Logout</span>
                </button>
            </div>
        </div>
        
        <button class="btn-icon" (click)="toggleStore()">
            <lucide-icon class="lucide-icon" name="store"></lucide-icon>
        </button>
        <button class="btn-icon" (click)="toggleBackpack()">
            <lucide-icon class="lucide-icon" name="backpack"></lucide-icon>
        </button>
        <button class="btn-icon" (click)="toggleMap()">
            <lucide-icon class="lucide-icon" name="map-pinned"></lucide-icon>
        </button>
    </div>
    <div class="game-timers" *ngIf="parentType === 'game-phase'">
        <span class="game-time">{{currentTime}}</span>
        <span class="watch-time" [class.active]="watchTime" [style.color]="'#00D819'">{{watchTime}}</span>
    </div>
    <div class="right">
        <div class="money">
            <lucide-icon name="circle-dollar-sign" class="lucide-icon" [size]="32"></lucide-icon>
            <span class="amount">{{ userData?.coins }}</span>
        </div>
        <div class="reputation">
            <lucide-icon name="sparkles" class="lucide-icon" [size]="32"></lucide-icon>
            <span class="amount">{{ userData?.reputation }}</span>
            @if (userData) {
            <lucide-icon name="move-up-right" class="lucide-icon" [size]="16" color="#00D819"></lucide-icon>
            } @else {
            <lucide-icon name="move-down-right" class="lucide-icon" [size]="16" color="#FF0000"></lucide-icon>
            }
        </div>
        <div class="user-info">
            <div class="user-icon-wrapper">
                <img 
                    [src]="getUserAvatarUrl()"
                    [alt]="userData?.name || 'Avatar do usuário'"
                    (error)="onAvatarImageError($event)"
                    class="user-avatar">
            </div>
            <span class="user-name">{{ userData?.name }}</span>
        </div>
    </div>
</header>

<app-store #store (storeStateChanged)="onStoreStateChanged($event)"></app-store>
<app-backpack #backpack></app-backpack>
<app-map #map></app-map>

<app-confirm-dialog 
    [visible]="confirmDialogVisible" 
    [title]="confirmDialogTitle" 
    [message]="confirmDialogMessage"
    (confirm)="confirmLogout()" 
    (cancel)="onCancel()">
</app-confirm-dialog>