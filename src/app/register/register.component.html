<div class="login-background">
    <div class="animated-line l1"></div>
    <div class="animated-line l2"></div>
    <div class="animated-line l3"></div>
    <div class="animated-line l4"></div>
    <div class="animated-letters">
        <div class="letter-line letter-u"></div>
        <div class="letter-line letter-u-bottom"></div>
        <div class="letter-line letter-m"></div>
        <div class="letter-line letter-m-mid"></div>
        <div class="letter-line letter-l"></div>
        <div class="letter-line letter-l-bottom"></div>
    </div>
</div>

<div class="register-container">
    <div class="register-card">
        <div class="card-header">
            <button type="button" class="back-button" (click)="goToHome()">
                ← Já tem uma conta? Faça login
            </button>
            <h2>Cadastro</h2>
        </div>
        <form id="registerForm" [formGroup]="registerForm" (ngSubmit)="onSubmit()">
            <div class="form-group">
                <label for="nome">Nome:</label>
                <input type="text" id="nome" formControlName="nome" placeholder="Seu nome">
                <div *ngIf="registerForm.get('nome')?.invalid && registerForm.get('nome')?.touched"
                    class="error-message">
                    Nome é obrigatório.
                </div>
            </div>
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" formControlName="email" placeholder="Seu email">
                <div *ngIf="registerForm.get('email')?.invalid && registerForm.get('email')?.touched"
                    class="error-message">
                    Email é obrigatório e deve ser válido.
                </div>
            </div>
            <div class="form-group">
                <label for="senha">Senha:</label>
                <input type="password" id="senha" formControlName="senha" placeholder="Sua senha">
                <div *ngIf="registerForm.get('senha')?.invalid && registerForm.get('senha')?.touched"
                    class="error-message">
                    Senha é obrigatória e deve ter pelo menos 6 caracteres.
                </div>
            </div>
            <div class="form-group">
                <label for="confirmSenha">Confirmar Senha:</label>
                <input type="password" id="confirmSenha" formControlName="confirmSenha"
                    placeholder="Confirme sua senha">
                <div *ngIf="registerForm.get('confirmSenha')?.invalid && registerForm.get('confirmSenha')?.touched"
                    class="error-message">
                    Confirmação de senha é obrigatória.
                </div>
                <div *ngIf="registerForm.hasError('mismatch') && registerForm.get('confirmSenha')?.touched"
                    class="error-message">
                    Senhas não conferem.
                </div>
            </div>
        </form>

        <div class="character-selection">
            <label>Escolha seu Avatar:</label>

            <div *ngIf="isLoadingAvatars" class="loading-avatars">
                <p>Carregando avatares<span class="dots"><span>.</span><span>.</span><span>.</span></span></p>
            </div>

            <div *ngIf="avatarsLoadError && !isLoadingAvatars" class="error-avatars">
                <div class="error-icon">⚠️</div>
                <p class="error-title">Erro de Conexão</p>
                <p class="error-description">Não foi possível carregar os avatares do servidor.</p>
                <button type="button" class="retry-button" (click)="retryLoadAvatars()">
                    Tentar Novamente
                </button>
            </div>

            <div *ngIf="!isLoadingAvatars && !avatarsLoadError" class="character-list">
                <div *ngFor="let avatar of avatars" class="character-item"
                    [class.selected]="selectedAvatar?.id === avatar.id || selectedAvatar?.filePath === avatar.filePath"
                    (click)="selectAvatar(avatar)">
                    <img [src]="getAvatarImageUrl(avatar)" [alt]="'Avatar ' + (avatar.id || avatar.filePath)"
                        (error)="onImageError($event)">
                </div>
            </div>

            <div *ngIf="registerForm.get('avatar')?.invalid && registerForm.get('avatar')?.touched"
                class="error-message">
                Por favor, selecione um avatar.
            </div>
        </div>
        =
        <button type="submit" form="registerForm" [disabled]="!registerForm.valid || isLoading || !selectedAvatar">
            {{ isLoading ? 'Cadastrando...' : 'Cadastrar' }}
        </button>

        <div *ngIf="errorMessage" class="error-message response-error">
            {{ errorMessage }}
        </div>

        <!-- <p class="login-link">Já tem uma conta? <a routerLink="/login">Faça login</a></p> -->
    </div>
</div>